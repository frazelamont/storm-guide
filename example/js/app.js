(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _stormGuide = require('./libs/storm-guide');

var _stormGuide2 = _interopRequireDefault(_stormGuide);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var onDOMContentLoadedTasks = [function () {
  _stormGuide2.default.init();
}];

if ('addEventListener' in window) window.addEventListener('DOMContentLoaded', function () {
  onDOMContentLoadedTasks.forEach(function (fn) {
    return fn();
  });
});

},{"./libs/storm-guide":2}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
/**
 * @name storm-guide: GDS Guide page-like implementation
 * @version 0.1.1: Thu, 05 Jan 2017 17:57:29 GMT
 * @author stormid
 * @license MIT
 */
var defaults = {
	linkClassName: '.js-guide__link',
	sectionClassName: '.js-guide__section',
	incrementalNavHolder: '.js-guide__incremental',
	activeClassName: 'active'
},
    hash = location.hash.slice(1) || null,
    templates = {
	previousNav: ['<a href="{{link}}" rel="previous" class="js-guide__incremental--previous nav-incremental-link page-navigation__prev">', '<div class="nav-incremental__part">Part {{num}}</div>', '<div class="nav-incremental__title">{{title}}</div>', '</div>'].join(''),
	nextNav: ['<a href="{{link}}" rel="next" class="js-guide__incremental--previous nav-incremental-link page-navigation__prev">', '<div class="nav-incremental__part">Part {{num}}</div>', '<div class="nav-incremental__title">{{title}}</div>', '</div>'].join('')
},
    render = function render(template, data) {
	for (var k in data) {
		if (data.hasOwnProperty(k)) {
			template = template.split('{{' + k + '}}').join(data[k]);
		}
	}
	return template;
};

var StormGuide = {
	init: function init() {
		if (hash) window.location.hash = '';

		this.links = [].slice.call(document.querySelectorAll(this.settings.linkClassName)) || null;
		this.sections = [].slice.call(document.querySelectorAll(this.settings.sectionClassName));
		this.incrementalNavHolder = document.querySelector(this.settings.incrementalNavHolder) || null;
		this.currentIndex = 0;
		this.currentTitle = '';

		if (!this.links || !this.sections || !this.incrementalNavHolder) throw new Error('Guide could not be initialised, ');

		this.setInitialState();
		this.setVisibility();
		this.setAria();
		this.renderIncrementalNav();
		this.bindEvents('.js-guide__link');

		return this;
	},
	setInitialState: function setInitialState() {
		var _this = this;

		this.links.forEach(function (link, i) {
			if (link.getAttribute('href').substr(1) === hash) {
				_this.currentIndex = i;
				_this.currentTitle = link.innerText;
			}
		});
		!this.currentTitle ? this.links[this.currentIndex].innerText : this.currentTitle;
	},
	setVisibility: function setVisibility(previousIndex) {
		if (previousIndex !== undefined) {
			this.links[previousIndex].classList.remove(this.settings.activeClassName);
			this.sections[previousIndex].classList.remove(this.settings.activeClassName);
		}
		this.links[this.currentIndex].classList.add(this.settings.activeClassName);
		this.sections[this.currentIndex].classList.add(this.settings.activeClassName);

		window.scrollTo(0, 0);
		window.setTimeout(function () {
			if (hash && window.location.hash === '') !!window.history && !!window.history.pushState && window.history.pushState({ URL: '#' + hash }, '', '#' + hash);
			window.scrollTo(0, 0);
		}, 0);
	},
	setAria: function setAria() {
		for (var i = 0; i < this.links.length; i++) {
			this.links[i].setAttribute('aria-selected', this.currentIndex === i);
			this.links[i].setAttribute('aria-controls', this.links[i].getAttribute('href').substr(1));
			this.sections[i].setAttribute('aria-hidden', !(this.currentIndex === i));
		}
	},
	renderIncrementalNav: function renderIncrementalNav() {
		var _this2 = this;

		var incrementalNav = '',
		    getNavData = function getNavData(i) {
			return {
				link: _this2.links[i].href,
				num: i + 1,
				title: _this2.links[i].innerText
			};
		};

		if (this.currentIndex > 0) incrementalNav = render(templates.previousNav, getNavData(this.currentIndex - 1));

		if (this.currentIndex !== this.links.length - 1) incrementalNav += render(templates.nextNav, getNavData(this.currentIndex + 1));

		this.incrementalNavHolder.innerHTML = incrementalNav;
		this.bindEvents('.js-guide__incremental--previous, .js-guide__incremental--next');
	},
	bindEvents: function bindEvents(sel) {
		var _this3 = this;

		[].slice.call(document.querySelectorAll(sel)).forEach(function (btn) {
			btn.addEventListener('click', _this3.change.bind(_this3));
		});
	},
	change: function change(e) {
		e.preventDefault();
		var previousIndex = this.currentIndex,
		    nextUrl = (e.target.parentNode.getAttribute('href') || e.target.getAttribute('href')).split('#')[1],
		    nextIndex = this.getNextIndex('#' + nextUrl);

		if (previousIndex === nextIndex) return;

		this.currentIndex = nextIndex;
		this.setVisibility(previousIndex);
		this.setAria();
		this.renderIncrementalNav();

		!!window.history && !!window.history.pushState && window.history.pushState({ URL: '#' + nextUrl }, '', '#' + nextUrl);
	},
	getNextIndex: function getNextIndex(href) {
		return this.links.reduce(function (a, link, i) {
			if (link.getAttribute('href') === href) a.push(i);return a;
		}, [])[0];
	}
};

var init = function init(opts) {
	return Object.assign(Object.create(StormGuide), {
		settings: Object.assign({}, defaults, opts)
	}).init();
};

exports.default = { init: init };

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJleGFtcGxlL3NyYy9hcHAuanMiLCJleGFtcGxlL3NyYy9saWJzL3N0b3JtLWd1aWRlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7QUNBQTs7Ozs7Ozs7QUFFQSxJQUFNLDJCQUEyQixZQUFNLEFBQ3RDO3VCQUFBLEFBQU0sQUFDTjtBQUZELEFBQWdDLENBQUE7O0FBSWhDLElBQUcsc0JBQUgsQUFBeUIsZUFBUSxBQUFPLGlCQUFQLEFBQXdCLG9CQUFvQixZQUFNLEFBQUU7MEJBQUEsQUFBd0IsUUFBUSxVQUFBLEFBQUMsSUFBRDtXQUFBLEFBQVE7QUFBeEMsQUFBZ0Q7QUFBcEcsQ0FBQTs7Ozs7Ozs7QUNOakM7Ozs7OztBQU1BLElBQU07Z0JBQVcsQUFDQSxBQUNmO21CQUZlLEFBRUcsQUFDbEI7dUJBSGUsQUFHTyxBQUN0QjtrQkFKRixBQUFpQixBQUlFO0FBSkYsQUFDZjtJQUtELE9BQU8sU0FBQSxBQUFTLEtBQVQsQUFBYyxNQUFkLEFBQW9CLE1BTjVCLEFBTWtDO0lBQ2pDO2NBQ2MsQ0FBQSxBQUFDLHlIQUFELEFBQ1QseURBRFMsQUFFVCx1REFGUyxBQUdULFVBSFMsQUFHQyxLQUpILEFBQ0UsQUFHTSxBQUNuQjtVQUFTLENBQUEsQUFBQyxxSEFBRCxBQUNMLHlEQURLLEFBRUwsdURBRkssQUFHTCxVQUhLLEFBR0ssS0FmaEIsQUFPYSxBQUtGLEFBR1U7QUFSUixBQUNYO0lBU0QsU0FBUyxTQUFULEFBQVMsT0FBQSxBQUFTLFVBQVQsQUFBbUIsTUFBSyxBQUNoQztNQUFJLElBQUosQUFBUSxLQUFSLEFBQWEsTUFBSyxBQUNqQjtNQUFHLEtBQUEsQUFBSyxlQUFSLEFBQUcsQUFBb0IsSUFBRyxBQUN6QjtjQUFXLFNBQUEsQUFBUyxNQUFNLE9BQUEsQUFBTyxJQUF0QixBQUEwQixNQUExQixBQUFnQyxLQUFLLEtBQWhELEFBQVcsQUFBcUMsQUFBSyxBQUNyRDtB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bEI7O0FBNEZELElBQU0sT0FBTyxTQUFQLEFBQU8sV0FBUSxBQUNwQjtlQUFPLEFBQU8sT0FBTyxPQUFBLEFBQU8sT0FBckIsQUFBYyxBQUFjO1lBQ3hCLE9BQUEsQUFBTyxPQUFQLEFBQWMsSUFBZCxBQUFrQixVQUR0QixBQUF5QyxBQUNyQyxBQUE0QjtBQURTLEFBQy9DLEVBRE0sRUFBUCxBQUFPLEFBRUosQUFDSDtBQUpEOztrQkFNZSxFQUFFLE0sQUFBRiIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJpbXBvcnQgR3VpZGUgZnJvbSAnLi9saWJzL3N0b3JtLWd1aWRlJztcblxuY29uc3Qgb25ET01Db250ZW50TG9hZGVkVGFza3MgPSBbKCkgPT4ge1xuXHRHdWlkZS5pbml0KCk7XG59XTtcbiAgICBcbmlmKCdhZGRFdmVudExpc3RlbmVyJyBpbiB3aW5kb3cpIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4geyBvbkRPTUNvbnRlbnRMb2FkZWRUYXNrcy5mb3JFYWNoKChmbikgPT4gZm4oKSk7IH0pOyIsIi8qKlxuICogQG5hbWUgc3Rvcm0tZ3VpZGU6IEdEUyBHdWlkZSBwYWdlLWxpa2UgaW1wbGVtZW50YXRpb25cbiAqIEB2ZXJzaW9uIDAuMS4xOiBUaHUsIDA1IEphbiAyMDE3IDE3OjU3OjI5IEdNVFxuICogQGF1dGhvciBzdG9ybWlkXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuY29uc3QgZGVmYXVsdHMgPSB7XG5cdFx0bGlua0NsYXNzTmFtZTogJy5qcy1ndWlkZV9fbGluaycsXG5cdFx0c2VjdGlvbkNsYXNzTmFtZTogJy5qcy1ndWlkZV9fc2VjdGlvbicsXG5cdFx0aW5jcmVtZW50YWxOYXZIb2xkZXI6ICcuanMtZ3VpZGVfX2luY3JlbWVudGFsJyxcblx0XHRhY3RpdmVDbGFzc05hbWU6ICdhY3RpdmUnXG5cdH0sXG5cdGhhc2ggPSBsb2NhdGlvbi5oYXNoLnNsaWNlKDEpIHx8IG51bGwsXG5cdHRlbXBsYXRlcyA9IHtcblx0XHRwcmV2aW91c05hdjogWyc8YSBocmVmPVwie3tsaW5rfX1cIiByZWw9XCJwcmV2aW91c1wiIGNsYXNzPVwianMtZ3VpZGVfX2luY3JlbWVudGFsLS1wcmV2aW91cyBuYXYtaW5jcmVtZW50YWwtbGluayBwYWdlLW5hdmlnYXRpb25fX3ByZXZcIj4nLFxuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCJuYXYtaW5jcmVtZW50YWxfX3BhcnRcIj5QYXJ0IHt7bnVtfX08L2Rpdj4nLFxuXHRcdFx0XHRcdFx0JzxkaXYgY2xhc3M9XCJuYXYtaW5jcmVtZW50YWxfX3RpdGxlXCI+e3t0aXRsZX19PC9kaXY+Jyxcblx0XHRcdFx0XHRcdCc8L2Rpdj4nXS5qb2luKCcnKSxcblx0XHRuZXh0TmF2OiBbJzxhIGhyZWY9XCJ7e2xpbmt9fVwiIHJlbD1cIm5leHRcIiBjbGFzcz1cImpzLWd1aWRlX19pbmNyZW1lbnRhbC0tcHJldmlvdXMgbmF2LWluY3JlbWVudGFsLWxpbmsgcGFnZS1uYXZpZ2F0aW9uX19wcmV2XCI+Jyxcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwibmF2LWluY3JlbWVudGFsX19wYXJ0XCI+UGFydCB7e251bX19PC9kaXY+Jyxcblx0XHRcdFx0XHRcdCc8ZGl2IGNsYXNzPVwibmF2LWluY3JlbWVudGFsX190aXRsZVwiPnt7dGl0bGV9fTwvZGl2PicsXG5cdFx0XHRcdFx0XHQnPC9kaXY+J10uam9pbignJylcblx0fSxcblx0cmVuZGVyID0gZnVuY3Rpb24odGVtcGxhdGUsIGRhdGEpe1xuXHRcdGZvcih2YXIgayBpbiBkYXRhKXtcblx0XHRcdGlmKGRhdGEuaGFzT3duUHJvcGVydHkoaykpe1xuXHRcdFx0XHR0ZW1wbGF0ZSA9IHRlbXBsYXRlLnNwbGl0KCd7eycgKyBrICsgJ319Jykuam9pbihkYXRhW2tdKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHRlbXBsYXRlO1xuXHR9O1xuXG5jb25zdCBTdG9ybUd1aWRlID0ge1xuXHRpbml0KCl7XG5cdFx0aWYoaGFzaCkgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAnJztcblxuXHRcdHRoaXMubGlua3MgPSBbXS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5zZXR0aW5ncy5saW5rQ2xhc3NOYW1lKSkgfHwgbnVsbDtcblx0XHR0aGlzLnNlY3Rpb25zID0gW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuc2V0dGluZ3Muc2VjdGlvbkNsYXNzTmFtZSkpO1xuXHRcdHRoaXMuaW5jcmVtZW50YWxOYXZIb2xkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuc2V0dGluZ3MuaW5jcmVtZW50YWxOYXZIb2xkZXIpIHx8IG51bGw7XG5cdFx0dGhpcy5jdXJyZW50SW5kZXggPSAwO1xuXHRcdHRoaXMuY3VycmVudFRpdGxlID0gJyc7XG5cblx0XHRpZighdGhpcy5saW5rcyB8fCAhdGhpcy5zZWN0aW9ucyB8fCAhdGhpcy5pbmNyZW1lbnRhbE5hdkhvbGRlcikgdGhyb3cgbmV3IEVycm9yKCdHdWlkZSBjb3VsZCBub3QgYmUgaW5pdGlhbGlzZWQsICcpO1xuXHRcdFxuXHRcdHRoaXMuc2V0SW5pdGlhbFN0YXRlKCk7XG5cdFx0dGhpcy5zZXRWaXNpYmlsaXR5KCk7XG5cdFx0dGhpcy5zZXRBcmlhKCk7XG5cdFx0dGhpcy5yZW5kZXJJbmNyZW1lbnRhbE5hdigpO1xuXHRcdHRoaXMuYmluZEV2ZW50cygnLmpzLWd1aWRlX19saW5rJyk7XG5cblx0XHRyZXR1cm4gdGhpcztcblx0XHRcblx0fSxcblx0c2V0SW5pdGlhbFN0YXRlKCl7XG5cdFx0dGhpcy5saW5rcy5mb3JFYWNoKChsaW5rLCBpKSA9PiB7XG5cdFx0XHRpZihsaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpLnN1YnN0cigxKSA9PT0gaGFzaCkge1xuXHRcdFx0XHR0aGlzLmN1cnJlbnRJbmRleCA9IGk7XG5cdFx0XHRcdHRoaXMuY3VycmVudFRpdGxlID0gbGluay5pbm5lclRleHQ7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0IXRoaXMuY3VycmVudFRpdGxlID8gdGhpcy5saW5rc1t0aGlzLmN1cnJlbnRJbmRleF0uaW5uZXJUZXh0IDogdGhpcy5jdXJyZW50VGl0bGU7XG5cdH0sXG5cdHNldFZpc2liaWxpdHkocHJldmlvdXNJbmRleCl7XG5cdFx0aWYocHJldmlvdXNJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHR0aGlzLmxpbmtzW3ByZXZpb3VzSW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5zZXR0aW5ncy5hY3RpdmVDbGFzc05hbWUpO1xuXHRcdFx0dGhpcy5zZWN0aW9uc1twcmV2aW91c0luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuc2V0dGluZ3MuYWN0aXZlQ2xhc3NOYW1lKTtcblx0XHR9XG5cdFx0dGhpcy5saW5rc1t0aGlzLmN1cnJlbnRJbmRleF0uY2xhc3NMaXN0LmFkZCh0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzTmFtZSk7XG5cdFx0dGhpcy5zZWN0aW9uc1t0aGlzLmN1cnJlbnRJbmRleF0uY2xhc3NMaXN0LmFkZCh0aGlzLnNldHRpbmdzLmFjdGl2ZUNsYXNzTmFtZSk7XG5cdFx0XG5cdFx0d2luZG93LnNjcm9sbFRvKDAsMCk7XG5cdFx0d2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0aWYoaGFzaCAmJiB3aW5kb3cubG9jYXRpb24uaGFzaCA9PT0gJycpICAoISF3aW5kb3cuaGlzdG9yeSAmJiAhIXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgJiYgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgVVJMOiBgIyR7aGFzaH1gfSwgJycsIGAjJHtoYXNofWApO1xuXHRcdFx0d2luZG93LnNjcm9sbFRvKDAsMCk7XG5cdFx0fSwgMCk7XG5cdH0sXG5cdHNldEFyaWEoKXtcblx0XHRmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5saW5rcy5sZW5ndGg7IGkrKyl7XG5cdFx0XHR0aGlzLmxpbmtzW2ldLnNldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcsIHRoaXMuY3VycmVudEluZGV4ID09PSBpKTtcblx0XHRcdHRoaXMubGlua3NbaV0uc2V0QXR0cmlidXRlKCdhcmlhLWNvbnRyb2xzJywgdGhpcy5saW5rc1tpXS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKS5zdWJzdHIoMSkpO1xuXHRcdFx0dGhpcy5zZWN0aW9uc1tpXS5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgISh0aGlzLmN1cnJlbnRJbmRleCA9PT0gaSkpO1xuXHRcdH1cblx0fSxcblx0cmVuZGVySW5jcmVtZW50YWxOYXYoKXtcblx0XHR2YXIgaW5jcmVtZW50YWxOYXYgPSAnJyxcblx0XHRcdGdldE5hdkRhdGEgPSBpID0+IHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRsaW5rOiB0aGlzLmxpbmtzW2ldLmhyZWYsXG5cdFx0XHRcdFx0bnVtOiBpICsgMSxcblx0XHRcdFx0XHR0aXRsZTogdGhpcy5saW5rc1tpXS5pbm5lclRleHRcblx0XHRcdFx0fTtcblx0XHRcdH07XG5cdFx0XG5cdFx0aWYodGhpcy5jdXJyZW50SW5kZXggPiAwKSBpbmNyZW1lbnRhbE5hdiA9IHJlbmRlcih0ZW1wbGF0ZXMucHJldmlvdXNOYXYsIGdldE5hdkRhdGEodGhpcy5jdXJyZW50SW5kZXggLSAxKSk7XG5cdFx0XG5cdFx0aWYodGhpcy5jdXJyZW50SW5kZXggIT09IHRoaXMubGlua3MubGVuZ3RoIC0gMSkgaW5jcmVtZW50YWxOYXYgKz0gcmVuZGVyKHRlbXBsYXRlcy5uZXh0TmF2LCBnZXROYXZEYXRhKHRoaXMuY3VycmVudEluZGV4ICsgMSkpO1xuXHRcdFxuXHRcdHRoaXMuaW5jcmVtZW50YWxOYXZIb2xkZXIuaW5uZXJIVE1MID0gaW5jcmVtZW50YWxOYXY7XG5cdFx0dGhpcy5iaW5kRXZlbnRzKCcuanMtZ3VpZGVfX2luY3JlbWVudGFsLS1wcmV2aW91cywgLmpzLWd1aWRlX19pbmNyZW1lbnRhbC0tbmV4dCcpO1xuXHR9LFxuXHRiaW5kRXZlbnRzKHNlbCkge1xuXHRcdFtdLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWwpKS5mb3JFYWNoKGJ0biA9PiB7XG5cdFx0XHRidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNoYW5nZS5iaW5kKHRoaXMpKTtcblx0XHR9KTtcblx0fSxcblx0Y2hhbmdlKGUpIHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0bGV0IHByZXZpb3VzSW5kZXggPSB0aGlzLmN1cnJlbnRJbmRleCxcblx0XHRcdG5leHRVcmwgPSAoZS50YXJnZXQucGFyZW50Tm9kZS5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSkuc3BsaXQoJyMnKVsxXSxcblx0XHRcdG5leHRJbmRleCA9IHRoaXMuZ2V0TmV4dEluZGV4KCcjJyArIG5leHRVcmwpO1xuXHRcdFxuXHRcdGlmKHByZXZpb3VzSW5kZXggPT09IG5leHRJbmRleCkgcmV0dXJuO1xuXHRcdFxuXHRcdHRoaXMuY3VycmVudEluZGV4ID0gbmV4dEluZGV4O1xuXHRcdHRoaXMuc2V0VmlzaWJpbGl0eShwcmV2aW91c0luZGV4KTtcblx0XHR0aGlzLnNldEFyaWEoKTtcblx0XHR0aGlzLnJlbmRlckluY3JlbWVudGFsTmF2KCk7XG5cblx0XHQoISF3aW5kb3cuaGlzdG9yeSAmJiAhIXdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkgJiYgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHsgVVJMOiAnIycgKyBuZXh0VXJsIH0sICcnLCAnIycgKyBuZXh0VXJsKTtcblx0fSxcblx0Z2V0TmV4dEluZGV4KGhyZWYpe1xuXHRcdHJldHVybiB0aGlzLmxpbmtzLnJlZHVjZSgoYSwgbGluaywgaSkgPT4geyBpZihsaW5rLmdldEF0dHJpYnV0ZSgnaHJlZicpID09PSBocmVmKSBhLnB1c2goaSk7IHJldHVybiBhOyB9LCBbXSlbMF07XG5cdH1cbn07XG5cbmNvbnN0IGluaXQgPSBvcHRzID0+IHtcblx0cmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShTdG9ybUd1aWRlKSwge1xuXHRcdHNldHRpbmdzOiBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cywgb3B0cylcblx0fSkuaW5pdCgpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgeyBpbml0IH07Il19
